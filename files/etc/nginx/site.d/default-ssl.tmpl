server {

    listen      443 ssl;
    server_name {{ .Env.DOMAIN }};
    root        {{ .Env.WEBROOT }};
    index       index.html index.php index.htm;
    charset     utf-8;

    include     /etc/nginx/common.d/*.conf;

    access_log  /var/log/nginx/access.log logformat;
    error_log   /var/log/nginx/error.log error;

    ssl_certificate /var/certs/{{ .Env.DOMAIN }}.crt;
    ssl_certificate_key /var/certs/{{ .Env.DOMAIN }}.key;

    location ~ [^/]\.php(/|$)
    {
        if (!-f $document_root$fastcgi_script_name) {
            return 404;
        }
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-NginX-Proxy true;

        include fastcgi_params;
        fastcgi_index                 index.php;
        fastcgi_split_path_info       ^(.+\.php)(/.+)$;
        fastcgi_param PATH_INFO       $fastcgi_path_info;
        fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

        {{ .Env.NGINX_HEADER }}
        {{ .Env.NGINX_CORS_CONFIG }}

        fastcgi_pass {{ .Env.FASTCGI_PASS }};
    }

    location /protected/ {
        internal;
        alias   /var/www/protected/;
    }

    {{ .Env.NGINX_LOCATION }}

}
