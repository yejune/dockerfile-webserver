server {

    listen      443 ssl;
    server_name {{ .Env.DOMAIN }};
    root        {{ .Env.WEBROOT }};
    index       index.html index.php index.htm;
    charset     utf-8;

    include     /etc/nginx/common.d/*.conf;

    access_log  /var/log/nginx/access.log logformat;
    error_log   /var/log/nginx/error.log error;

    ssl_certificate /var/certs/{{ .Env.DOMAIN }}.crt;
    ssl_certificate_key /var/certs/{{ .Env.DOMAIN }}.key;

    location ~ [^/]\.php(/|$)
    {
        if (!-f $document_root$fastcgi_script_name) {
            return 404;
        }

        include /etc/nginx/variables.conf;

        {{ .Env.NGINX_HEADER }}
        {{ .Env.INCLUDE_NGINX_CORS_CONF }}

        fastcgi_pass {{ .Env.FASTCGI_PASS }};
    }

    location /protected/ {
        internal;
        alias   /var/www/protected/;
    }

    {{ .Env.NGINX_LOCATION }}

}
